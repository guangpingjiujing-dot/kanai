EC サイトの概念データモデル

【概要】

EC サイトの注文、注文明細、在庫管理を題材にしたデータモデリングのサンプルです。
正規化の学習と実践を目的としています。

【現在の業務の概要】

1. 顧客（Customer）

   (1) 顧客の識別：顧客は「顧客ID（customer_id）」で識別され、「顧客名（name）」「メールアドレス（email）」「電話番号（phone）」「登録日（registered_date）」を持つ。

   (2) 顧客と注文の関係：1 人の顧客は複数の注文を持つことができる。

   (3) 顧客と配送先の関係：1 人の顧客は複数の配送先を登録することができる。

2. 配送先（ShippingAddress）

   (1) 配送先の識別：配送先は「配送先ID（address_id）」で識別され、「郵便番号（postal_code）」「市区町村（city）」「番地（street_address）」「建物名（building_name）」「デフォルト配送先フラグ（is_default）」を持つ。

   (2) 顧客との関係：配送先は 1 人の顧客に紐づく。

   (3) 都道府県との関係：配送先は都道府県マスタを参照し、「都道府県ID（prefecture_id）」を持つ。

3. 都道府県（Prefecture）

   (1) 都道府県の識別：都道府県は「都道府県ID（prefecture_id）」で識別され、「都道府県コード（code）」「都道府県名（name）」「都道府県名カナ（name_kana）」を持つ。

   (2) 配送先との関係：都道府県マスタは複数の配送先から参照される。

   (3) 倉庫との関係：都道府県マスタは複数の倉庫から参照される。

4. 注文（Order）

   (1) 注文の識別：注文は「注文ID（order_id）」で識別され、「注文日（order_date）」「注文ステータス（status）」を持つ。

   (2) 顧客との関係：注文は 1 人の顧客に紐づく。注文には「顧客ID（customer_id）」を持つ。

   (3) 配送先との関係：注文は 1 つの配送先を使用する。注文には「配送先ID（address_id）」を持つ。

   (4) 注文明細との関係：1 つの注文は複数の注文明細を持つ。

   (5) 出荷との関係：1 つの注文に対して複数の出荷が発生する可能性がある（分割出荷対応）。

   (6) 決済との関係：1 つの注文に対して複数の決済試行が存在する可能性がある。

5. 注文明細（OrderDetail）

   (1) 注文明細の識別：注文明細は「注文明細ID（order_detail_id）」で識別され、「数量（quantity）」「単価（unit_price）」を持つ。

   (2) 注文との関係：注文明細は 1 つの注文に紐づく。注文明細には「注文ID（order_id）」を持つ。

   (3) 商品との関係：注文明細は 1 つの商品を対象とする。注文明細には「商品ID（product_id）」を持つ。

   (4) 注文時点の単価：注文明細には注文時点の単価を保持する。これにより、商品マスタの価格変更の影響を受けない。

6. 商品（Product）

   (1) 商品の識別：商品は「商品ID（product_id）」で識別され、「商品名（name）」「商品説明（description）」「価格（price）」「SKU（sku）」を持つ。

   (2) カテゴリとの関係：商品は 1 つのカテゴリに属する。商品には「カテゴリID（category_id）」を持つ。

   (3) 在庫との関係：1 つの商品は複数の在庫レコードを持つ。在庫 ID は個別の在庫アイテム 1 つ 1 つに振られる。

7. カテゴリ（Category）

   (1) カテゴリの識別：カテゴリは「カテゴリID（category_id）」で識別され、「カテゴリ名（name）」を持つ。

   (2) 階層構造：カテゴリは階層構造をサポートする。「親カテゴリID（parent_category_id）」により親カテゴリへの自己参照が可能。現在は 1 階層のみサポート。

8. 倉庫（Warehouse）

   (1) 倉庫の識別：倉庫は「倉庫ID（warehouse_id）」で識別され、「倉庫名（name）」「郵便番号（postal_code）」「市区町村（city）」「番地（street_address）」「電話番号（phone）」を持つ。

   (2) 都道府県との関係：倉庫は都道府県マスタを参照し、「都道府県ID（prefecture_id）」を持つ。

   (3) 在庫との関係：倉庫は複数の在庫アイテムを保管できる。

9. 在庫（Inventory）

   (1) 在庫の識別：在庫は「在庫ID（inventory_id）」で識別され、「在庫状態（status）」「入荷日（received_date）」「最終更新日（last_updated）」を持つ。

   (2) 在庫の個別管理：個別の在庫アイテム 1 つ 1 つを表すレコード。1 つの在庫 ID が 1 つの在庫アイテムに対応する。

   (3) 商品との関係：在庫は 1 つの商品に紐づく。在庫には「商品ID（product_id）」を持つ。

   (4) 倉庫との関係：在庫は 1 つの倉庫に保管される。在庫には「倉庫ID（warehouse_id）」を持つ。

   (5) 在庫の状態管理：在庫の状態（available/reserved/shipped など）を管理する。

   (6) 出荷明細との関係：1 つの在庫アイテムは 0 個または 1 個の出荷明細に含まれる。

10. 出荷（Shipment）

    (1) 出荷の識別：出荷は「出荷ID（shipment_id）」で識別され、「出荷日（shipment_date）」「配送会社（carrier）」「追跡番号（tracking_number）」「出荷ステータス（status）」「作成日（created_date）」を持つ。

    (2) 注文との関係：出荷は 1 つの注文に紐づく。出荷には「注文ID（order_id）」を持つ。1 つの注文に対して複数の出荷が発生する可能性がある（分割出荷対応）。

    (3) 出荷明細との関係：1 つの出荷は複数の出荷明細を持つ。

11. 出荷明細（ShipmentDetail）

    (1) 出荷明細の識別：出荷明細は「出荷明細ID（shipment_detail_id）」で識別され、「出荷日時（shipped_date）」を持つ。

    (2) 出荷との関係：出荷明細は 1 つの出荷に紐づく。出荷明細には「出荷ID（shipment_id）」を持つ。

    (3) 在庫との関係：出荷明細は 1 つの在庫アイテムを対象とする。出荷明細には「在庫ID（inventory_id）」を持つ。1 つの在庫アイテムは 0 個または 1 個の出荷明細に含まれる。

12. 支払い方法マスタ（PaymentMethod）

    (1) 支払い方法の識別：支払い方法は「支払い方法ID（payment_method_id）」で識別され、「支払い方法コード（code）」「支払い方法名（name）」「手数料（fee）」「有効フラグ（is_active）」を持つ。

    (2) 支払い方法の種類：クレジットカード、銀行振込、コンビニ決済、代金引換などを管理する。

    (3) 決済との関係：支払い方法マスタは複数の決済レコードから参照される。

13. 支払いステータスマスタ（PaymentStatus）

    (1) 支払いステータスの識別：支払いステータスは「支払いステータスID（payment_status_id）」で識別され、「ステータスコード（code）」「ステータス名（name）」「表示順序（display_order）」を持つ。

    (2) ステータスの種類：未払い、支払済み、支払失敗、返金済みなどの状態を管理する。

    (3) 決済との関係：支払いステータスマスタは複数の決済レコードから参照される。

14. 決済（Payment）

    (1) 決済の識別：決済は「決済ID（payment_id）」で識別され、「決済金額（amount）」「決済日（payment_date）」「取引ID（transaction_id）」「エラーメッセージ（error_message）」「作成日（created_date）」を持つ。

    (2) 注文との関係：決済は 1 つの注文に紐づく。決済には「注文ID（order_id）」を持つ。1 つの注文に対して複数の決済試行が存在する可能性がある。

    (3) 支払い方法との関係：決済は 1 つの支払い方法を使用する。決済には「支払い方法ID（payment_method_id）」を持つ。

    (4) 支払いステータスとの関係：決済は 1 つの支払いステータスを持つ。決済には「支払いステータスID（payment_status_id）」を持つ。
